"use strict";(self.webpackChunkreact_samurai_way=self.webpackChunkreact_samurai_way||[]).push([[164],{3164:function(e,s,a){a.r(s),a.d(s,{default:function(){return V}});var t=a(2791),n=a(7781),r=a(364),i=a(1413),o=a(6871),c=a(184),l=function(e){var s;return{isAuth:null===(s=e.auth.user)||void 0===s?void 0:s.data.login}},u=a(4384),g=a(6721),d=a(1218),h=a(5861),f=a(7757),m=a.n(f),v=[],M=null,p=function(){setTimeout((function(){return x}),3e3)},_=function(e){var s=JSON.parse(e.data);v.forEach((function(e){return e(s)}))},x=function(){var e,s,a,t,n;null===(e=M)||void 0===e||e.removeEventListener("close",p),null===(s=M)||void 0===s||s.removeEventListener("message",_),null===(a=M)||void 0===a||a.close(),null===(t=M=new WebSocket("wss://social-network.samuraijs.com/handlers/ChatHandler.ashx"))||void 0===t||t.addEventListener("close",p),null===(n=M)||void 0===n||n.addEventListener("message",_)},k=function(e){v=v.filter((function(s){return s!==e}))},j=function(e){var s;null===(s=M)||void 0===s||s.send(e)},P=a(3029),E=null,I=function(e){return null===E&&(E=function(s){e(function(e){return{type:P.U.SET_MESSAGES,payload:e}}(s))}),E},S=a(9439),w=a(2739),D="MessagesBlock_messagesBlock__lUyFf",L="MessagesBlock_messagesWrapper__BGvrI",N="MessagesBlock_emptyChatPlaceholder__SbQcB",y="MessagesBlock_textareaWrapper__AyuSx",T="MessagesBlock_newMessageField__XzIhT",C=function(e){var s=e.pathName,a=e.isDialogSelected,n=e.dialogs,r=e.messages,i=e.chatMessages,l=e.interlocutorId,u=e.authProfileId,g=e.authProfilePhoto,d=e.fetchMessagesPending,h=e.navigate,f=e.sendMessage,m=e.clearMessagesState,v=e.sendChatMessageThunk,M=e.startMessagesListening,p=e.stopMessagesListening,_=(0,t.useState)(""),x=(0,S.Z)(_,2),k=x[0],j=x[1],P=(0,t.useRef)(null),E="/messenger/chat"===s,I=E?i.length:r.length;(0,t.useEffect)((function(){var e=function(e){"Escape"!==e.key||d||(m(),h("messenger"))};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}})),(0,t.useEffect)((function(){return M(),function(){return p()}}),[]),(0,t.useEffect)((function(){var e;null===(e=P.current)||void 0===e||e.scrollTo(0,99999)}),[r,i,s]);return(0,c.jsxs)("div",{className:D,children:[(0,c.jsxs)("div",{ref:P,className:L,children:[!d&&(0,c.jsx)(B,{isDialogSelected:a,messagesLength:I}),(0,c.jsx)(o.j3,{context:{pathName:s,authProfileId:u,authProfilePhoto:g,dialogs:n,interlocutorId:l,messages:r,clearMessagesState:m,isDialogSelected:a,fetchMessagesPending:d,chatMessages:i,isChatSelected:E}})]}),(0,c.jsx)("div",{className:y,children:(0,c.jsx)("textarea",{onKeyDown:function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),E?v(k):f(l,k),j(""))},value:k,onChange:function(e){return j(e.target.value)},placeholder:"Write message",className:T})})]})},B=function(e){var s=e.messagesLength,a=e.isDialogSelected,t=!1===a?"Select a chat":"You can write your first message";return(0,c.jsx)(c.Fragment,{children:(0===s||!1===a)&&(0,c.jsxs)("div",{className:N,children:[(0,c.jsx)("div",{children:(0,c.jsx)(w.OR,{})}),(0,c.jsx)("div",{children:t})]})})},q=a(3504),W=a(9753),b=a(6074),A="DialogItem_userLink__8wrAN",G="DialogItem_active__QhM4T",Z="DialogItem_time__LGIbg",F="DialogItem_message__TG2Gp",Q="DialogItem_messageCounter__oyMyg",O="DialogItem_avatar__WYyE9",X="DialogItem_name__tXQI2",z=function(e){var s=e.dialogItem,a=s?s.id:"chat",t=s?(0,W.Pq)(s.userName,26):"WebSocket Chat";return(0,c.jsx)("li",{children:(0,c.jsxs)(q.OL,{className:(0,W.Xz)(A,G),to:"".concat(a),children:[(0,c.jsx)("div",{className:O,children:(0,c.jsx)(b.Z,{photo:s&&s.photos.small})}),(0,c.jsx)("div",{className:X,children:t}),(0,c.jsx)("p",{className:F,children:(0,W.Pq)("last message placeholder",26)}),(0,c.jsx)("time",{className:Z,children:s&&(0,W.fc)(s.lastDialogActivityDate,!1)}),s&&s.newMessagesCount>0&&(0,c.jsx)("div",{className:Q,children:s&&s.newMessagesCount})]})})},K="DialogsBlock_dialogsWrapper__MEPhg",R="DialogsBlock_dialogs__v0Ldo",U=function(e){var s=e.dialogs;return(0,c.jsx)("div",{className:K,children:(0,c.jsxs)("ul",{className:R,children:[(0,c.jsx)(z,{}),s.map((function(e){return(0,c.jsx)(z,{dialogItem:e},e.id)}))]})})},Y="Messenger_messenger__6NGfg",$=function(e){var s=e.pathName,a=e.dialogs,t=e.messages,n=e.chatMessages,r=e.authProfileId,i=e.authProfilePhoto,o=e.interlocutorId,l=e.fetchMessagesPending,u=e.sendMessage,g=e.clearMessagesState,d=e.isDialogSelected,h=e.navigate,f=e.sendChatMessageThunk,m=e.startMessagesListening,v=e.stopMessagesListening;return(0,c.jsxs)("div",{className:Y,children:[(0,c.jsx)(U,{dialogs:a}),(0,c.jsx)(C,{sendChatMessageThunk:f,stopMessagesListening:v,startMessagesListening:m,fetchMessagesPending:l,isDialogSelected:d,navigate:h,pathName:s,clearMessagesState:g,sendMessage:u,authProfileId:r,authProfilePhoto:i,dialogs:a,interlocutorId:o,messages:t,chatMessages:n})]})},H={fetchDialogsThunk:g.uV,fetchMessagesThunk:g.FQ,sendMessageThunk:g.Tu,sendChatMessageThunk:function(e){return function(){var s=(0,h.Z)(m().mark((function s(a){return m().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:j(e);case 1:case"end":return s.stop()}}),s)})));return function(e){return s.apply(this,arguments)}}()},clearMessagesState:d.vd,startMessagesListening:function(){return x(),function(){var e=(0,h.Z)(m().mark((function e(s){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=I(s),v.push(a);case 1:case"end":return e.stop()}var a}),e)})));return function(s){return e.apply(this,arguments)}}()},stopMessagesListening:function(){return function(){var e=(0,h.Z)(m().mark((function e(s){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:k(I(s));case 1:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}()}},J=(0,r.$j)((function(e){var s,a,t;return{dialogs:e.messenger.dialogs,messages:e.messenger.messages,chatMessages:e.chat.messages,fetchMessagesPending:e.messenger.requests.fetchMessagesPending,fetchMessagesError:e.messenger.requests.fetchMessagesError,fetchDialogsError:e.messenger.requests.fetchMessagesError,sendMessageError:e.messenger.requests.sendMessageError,authProfileId:null===(s=e.auth.user)||void 0===s?void 0:s.data.id,authProfilePhoto:null===(a=e.auth.user)||void 0===a||null===(t=a.data.photos)||void 0===t?void 0:t.small}}),H),V=(0,n.qC)(J,u.l,(function(e){return(0,r.$j)(l)((function(s){return s.isAuth?(0,c.jsx)(e,(0,i.Z)({},s)):(0,c.jsx)(o.Fg,{to:"/login"})}))}))((function(e){var s=e.route,a=e.dialogs,n=e.messages,r=e.chatMessages,i=e.authProfileId,o=e.authProfilePhoto,l=e.fetchMessagesPending,u=(e.fetchMessagesError,e.fetchDialogsError,e.sendMessageError,e.fetchDialogsThunk),g=e.fetchMessagesThunk,d=e.sendMessageThunk,h=e.sendChatMessageThunk,f=e.startMessagesListening,m=e.stopMessagesListening,v=e.clearMessagesState,M=parseInt(s.params.userId),p=!("/messenger/chat"!==s.location.pathname&&!M);return(0,t.useEffect)((function(){u()}),[u]),(0,t.useEffect)((function(){M&&g(M)}),[M]),(0,c.jsx)($,{isDialogSelected:p,navigate:s.navigate,pathName:s.location.pathname,interlocutorId:M,authProfilePhoto:o,authProfileId:i,messages:n,chatMessages:r,dialogs:a,sendMessage:d,fetchMessagesPending:l,clearMessagesState:v,sendChatMessageThunk:h,startMessagesListening:f,stopMessagesListening:m})}))}}]);
//# sourceMappingURL=164.29099993.chunk.js.map