"use strict";(self.webpackChunkreact_samurai_way=self.webpackChunkreact_samurai_way||[]).push([[164],{3164:function(e,s,a){a.r(s),a.d(s,{default:function(){return V}});var t=a(2791),n=a(7781),r=a(364),i=a(1413),o=a(6871),l=a(184),c=function(e){var s;return{isAuth:null===(s=e.auth.user)||void 0===s?void 0:s.data.login}},u=a(4384),g=a(6721),h=a(1218),d=a(5861),f=a(7757),m=a.n(f),M=[],v=null,p=function(){setTimeout((function(){return x}),3e3)},_=function(e){var s=JSON.parse(e.data);M.forEach((function(e){return e(s)}))},x=function(){var e,s,a,t,n;null===(e=v)||void 0===e||e.removeEventListener("close",p),null===(s=v)||void 0===s||s.removeEventListener("message",_),null===(a=v)||void 0===a||a.close(),null===(t=v=new WebSocket("wss://social-network.samuraijs.com/handlers/ChatHandler.ashx"))||void 0===t||t.addEventListener("close",p),null===(n=v)||void 0===n||n.addEventListener("message",_)},j=function(e){M=M.filter((function(s){return s!==e}))},P=function(e){var s;null===(s=v)||void 0===s||s.send(e)},k=a(3029),I=null,S=function(e){return null===I&&(I=function(s){e(function(e){return{type:k.U.SET_MESSAGES,payload:e}}(s))}),I},D=a(9439),E=a(2739),N="MessagesBlock_messagesBlock__lUyFf",L="MessagesBlock_messagesWrapper__BGvrI",w="MessagesBlock_emptyChatPlaceholder__SbQcB",T="MessagesBlock_textareaWrapper__AyuSx",y="MessagesBlock_newMessageField__XzIhT",C=function(e){var s=e.pathName,a=e.isDialogSelected,n=e.dialogs,r=e.messages,i=e.chatMessages,c=e.interlocutorId,u=e.authProfileId,g=e.authProfilePhoto,h=e.fetchMessagesPending,d=e.sendMessage,f=e.clearMessagesState,m=e.sendChatMessageThunk,M=e.startMessagesListening,v=e.stopMessagesListening,p=(0,t.useState)(""),_=(0,D.Z)(p,2),x=_[0],j=_[1],P=(0,t.useRef)(null),k="/messenger/chat"===s,I=k?i.length:r.length;(0,t.useEffect)((function(){return M(),function(){return v()}}),[]),(0,t.useEffect)((function(){var e;null===(e=P.current)||void 0===e||e.scrollTo(0,99999)}),[r,i,s]);return(0,l.jsxs)("div",{className:N,children:[(0,l.jsxs)("div",{ref:P,className:L,children:[!h&&(0,l.jsx)(B,{isDialogSelected:a,messagesLength:I}),(0,l.jsx)(o.j3,{context:{pathName:s,authProfileId:u,authProfilePhoto:g,dialogs:n,interlocutorId:c,messages:r,clearMessagesState:f,isDialogSelected:a,fetchMessagesPending:h,chatMessages:i,isChatSelected:k}})]}),(0,l.jsx)("div",{className:T,children:(0,l.jsx)("textarea",{onKeyDown:function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),k?m(x):d(c,x),j(""))},value:x,onChange:function(e){return j(e.target.value)},placeholder:"Write message",className:y})})]})},B=function(e){var s=e.messagesLength,a=e.isDialogSelected,t=!1===a?"Select a chat":"You can write your first message";return(0,l.jsx)(l.Fragment,{children:(0===s||!1===a)&&(0,l.jsxs)("div",{className:w,children:[(0,l.jsx)("div",{children:(0,l.jsx)(E.OR,{})}),(0,l.jsx)("div",{children:t})]})})},q=a(3504),W=a(9753),b=a(6074),A="DialogItem_userLink__8wrAN",G="DialogItem_active__QhM4T",Z="DialogItem_time__LGIbg",F="DialogItem_message__TG2Gp",Q="DialogItem_messageCounter__oyMyg",O="DialogItem_avatar__WYyE9",X="DialogItem_name__tXQI2",z=function(e){var s=e.dialogItem,a=s?s.id:"chat",t=s?(0,W.Pq)(s.userName,26):"WebSocket Chat";return(0,l.jsx)("li",{children:(0,l.jsxs)(q.OL,{className:(0,W.Xz)(A,G),to:"".concat(a),children:[(0,l.jsx)("div",{className:O,children:(0,l.jsx)(b.Z,{photo:s&&s.photos.small})}),(0,l.jsx)("div",{className:X,children:t}),(0,l.jsx)("p",{className:F,children:(0,W.Pq)("lorem lorem lorem lorem",26)}),(0,l.jsx)("time",{className:Z,children:s&&(0,W.fc)(s.lastDialogActivityDate,!1)}),s&&s.newMessagesCount>0&&(0,l.jsx)("div",{className:Q,children:s&&s.newMessagesCount})]})})},K="DialogsBlock_dialogsWrapper__MEPhg",R="DialogsBlock_dialogs__v0Ldo",U=function(e){var s=e.dialogs;return(0,l.jsx)("div",{className:K,children:(0,l.jsxs)("ul",{className:R,children:[(0,l.jsx)(z,{}),s.map((function(e){return(0,l.jsx)(z,{dialogItem:e},e.id)}))]})})},Y="Messenger_messenger__6NGfg",$=function(e){var s=e.pathName,a=e.dialogs,t=e.messages,n=e.chatMessages,r=e.authProfileId,i=e.authProfilePhoto,o=e.interlocutorId,c=e.fetchMessagesPending,u=e.sendMessage,g=e.clearMessagesState,h=e.isDialogSelected,d=e.sendChatMessageThunk,f=e.startMessagesListening,m=e.stopMessagesListening;return(0,l.jsxs)("div",{className:Y,children:[(0,l.jsx)(U,{dialogs:a}),(0,l.jsx)(C,{sendChatMessageThunk:d,stopMessagesListening:m,startMessagesListening:f,fetchMessagesPending:c,isDialogSelected:h,pathName:s,clearMessagesState:g,sendMessage:u,authProfileId:r,authProfilePhoto:i,dialogs:a,interlocutorId:o,messages:t,chatMessages:n})]})},H={fetchDialogsThunk:g.uV,fetchMessagesThunk:g.FQ,sendMessageThunk:g.Tu,sendChatMessageThunk:function(e){return function(){var s=(0,d.Z)(m().mark((function s(a){return m().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:P(e);case 1:case"end":return s.stop()}}),s)})));return function(e){return s.apply(this,arguments)}}()},clearMessagesState:h.vd,startMessagesListening:function(){return x(),function(){var e=(0,d.Z)(m().mark((function e(s){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=S(s),M.push(a);case 1:case"end":return e.stop()}var a}),e)})));return function(s){return e.apply(this,arguments)}}()},stopMessagesListening:function(){return function(){var e=(0,d.Z)(m().mark((function e(s){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:j(S(s));case 1:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}()}},J=(0,r.$j)((function(e){var s,a,t;return{dialogs:e.messenger.dialogs,messages:e.messenger.messages,chatMessages:e.chat.messages,fetchMessagesPending:e.messenger.requests.fetchMessagesPending,fetchMessagesError:e.messenger.requests.fetchMessagesError,fetchDialogsError:e.messenger.requests.fetchMessagesError,sendMessageError:e.messenger.requests.sendMessageError,authProfileId:null===(s=e.auth.user)||void 0===s?void 0:s.data.id,authProfilePhoto:null===(a=e.auth.user)||void 0===a||null===(t=a.data.photos)||void 0===t?void 0:t.small}}),H),V=(0,n.qC)(J,u.l,(function(e){return(0,r.$j)(c)((function(s){return s.isAuth?(0,l.jsx)(e,(0,i.Z)({},s)):(0,l.jsx)(o.Fg,{to:"/login"})}))}))((function(e){var s=e.route,a=e.dialogs,n=e.messages,r=e.chatMessages,i=e.authProfileId,o=e.authProfilePhoto,c=e.fetchMessagesPending,u=(e.fetchMessagesError,e.fetchDialogsError,e.sendMessageError,e.fetchDialogsThunk),g=e.fetchMessagesThunk,h=e.sendMessageThunk,d=e.sendChatMessageThunk,f=e.startMessagesListening,m=e.stopMessagesListening,M=e.clearMessagesState,v=parseInt(s.params.userId),p=!("/messenger/chat"!==s.location.pathname&&!v);return(0,t.useEffect)((function(){u()}),[u]),(0,t.useEffect)((function(){v&&g(v)}),[v]),(0,l.jsx)($,{isDialogSelected:p,pathName:s.location.pathname,interlocutorId:v,authProfilePhoto:o,authProfileId:i,messages:n,chatMessages:r,dialogs:a,sendMessage:h,fetchMessagesPending:c,clearMessagesState:M,sendChatMessageThunk:d,startMessagesListening:f,stopMessagesListening:m})}))}}]);
//# sourceMappingURL=164.a4428b58.chunk.js.map